{"version":3,"file":"popup.js","sources":["../src/popup.ts"],"sourcesContent":["import { FolderVec } from \"./background\";\r\n\r\n// フォルダ情報のインターフェース\r\nexport interface Folder {\r\n  id: string;\r\n  title: string;\r\n  score: number;\r\n}\r\n\r\n// タブ情報のインターフェース\r\nexport interface Tab {\r\n  id?: number;\r\n  url?: string;\r\n  title?: string;\r\n}\r\n\r\n// レスポンスのインターフェース\r\n// export interface AnalysisResponse {\r\n//   folders?: Folder[];\r\n//   error?: string;\r\n// }\r\nexport interface AnalysisResponse {\r\n  ok: boolean;\r\n  result: FolderVec[];\r\n}\r\n\r\n// DOMの読み込みが完了したら実行\r\ndocument.addEventListener(\"DOMContentLoaded\", (): void => {\r\n  // ボタンのイベントリスナーを設定\r\n  setupButtonEventListeners();\r\n});\r\n\r\n// ボタンのイベントリスナーを設定する関数\r\nfunction setupButtonEventListeners(): void {\r\n  const rebuildButton: HTMLElement | null =\r\n    document.getElementById(\"rebuildButton\");\r\n  const suggestButton: HTMLElement | null =\r\n    document.getElementById(\"suggestButton\");\r\n\r\n  if (rebuildButton) {\r\n    rebuildButton.addEventListener(\"click\", handleRebuildFolders);\r\n  }\r\n\r\n  if (suggestButton) {\r\n    suggestButton.addEventListener(\"click\", handleSuggestFolders);\r\n  }\r\n}\r\n\r\n// フォルダ再構築ボタンのハンドラー\r\nasync function handleRebuildFolders(): Promise<void> {\r\n  const rebuildButton: HTMLElement | null =\r\n    document.getElementById(\"rebuildButton\");\r\n  const suggestButton: HTMLElement | null =\r\n    document.getElementById(\"suggestButton\");\r\n\r\n  // ボタンを無効化\r\n  if (rebuildButton) rebuildButton.setAttribute(\"disabled\", \"true\");\r\n  if (suggestButton) suggestButton.setAttribute(\"disabled\", \"true\");\r\n\r\n  updateStatus(\"フォルダを再構築中...\");\r\n\r\n  try {\r\n    const response = await chrome.runtime.sendMessage({\r\n      action: \"REBUILD_CENTROIDS\",\r\n    });\r\n\r\n    console.log(\"フォルダ再構築の応答:\", response);\r\n\r\n    if (response && response.ok) {\r\n      updateStatus(\"フォルダの再構築が完了しました\");\r\n    } else {\r\n      showError(\"フォルダの再構築中にエラーが発生しました\");\r\n    }\r\n  } catch (error) {\r\n    console.error(\"フォルダ再構築中にエラーが発生しました:\", error);\r\n    showError(\"フォルダの再構築中にエラーが発生しました\");\r\n  } finally {\r\n    // ボタンを再有効化\r\n    if (rebuildButton) rebuildButton.removeAttribute(\"disabled\");\r\n    if (suggestButton) suggestButton.removeAttribute(\"disabled\");\r\n  }\r\n}\r\n\r\n// 推薦ボタンのハンドラー\r\nasync function handleSuggestFolders(): Promise<void> {\r\n  const rebuildButton: HTMLElement | null =\r\n    document.getElementById(\"rebuildButton\");\r\n  const suggestButton: HTMLElement | null =\r\n    document.getElementById(\"suggestButton\");\r\n\r\n  // ボタンを無効化\r\n  if (rebuildButton) rebuildButton.setAttribute(\"disabled\", \"true\");\r\n  if (suggestButton) suggestButton.setAttribute(\"disabled\", \"true\");\r\n\r\n  // 現在のタブの情報を取得\r\n  const tabs: Tab[] = await chrome.tabs.query({\r\n    active: true,\r\n    currentWindow: true,\r\n  });\r\n  if (tabs.length === 0) {\r\n    showError(\"アクティブなタブが見つかりません\");\r\n    // ボタンを再有効化\r\n    if (rebuildButton) rebuildButton.removeAttribute(\"disabled\");\r\n    if (suggestButton) suggestButton.removeAttribute(\"disabled\");\r\n    return;\r\n  }\r\n\r\n  const currentTab: Tab = tabs[0];\r\n\r\n  // ステータス表示を更新\r\n  updateStatus(\"ページを分析中...\");\r\n\r\n  try {\r\n    // バックグラウンドスクリプトにメッセージを送信してページを分析\r\n    const response: AnalysisResponse = await chrome.runtime.sendMessage({\r\n      action: \"SUGGEST_FOLDERS\",\r\n    });\r\n\r\n    console.log(\"バックグラウンドスクリプトからの応答:\", response);\r\n\r\n    // レスポンスの存在チェックを追加\r\n    if (!response) {\r\n      showError(\"バックグラウンドスクリプトからの応答がありません\");\r\n      return;\r\n    }\r\n\r\n    // レスポンスを処理\r\n    if (response.result && response.result.length > 0) {\r\n      // 推奨フォルダを表示\r\n      displayRecommendedFolders(response.result, currentTab);\r\n    } else {\r\n      // 推奨フォルダが見つからない場合\r\n      updateStatus(\"適切なフォルダが見つかりませんでした\");\r\n    }\r\n  } catch (error) {\r\n    console.error(\"エラーが発生しました:\", error);\r\n    showError(\"ページの分析中にエラーが発生しました\");\r\n  } finally {\r\n    // ボタンを再有効化\r\n    if (rebuildButton) rebuildButton.removeAttribute(\"disabled\");\r\n    if (suggestButton) suggestButton.removeAttribute(\"disabled\");\r\n  }\r\n}\r\n\r\n// ステータス表示を更新する関数\r\nexport function updateStatus(message: string): void {\r\n  const statusElement: HTMLElement | null = document.getElementById(\"status\");\r\n  if (statusElement) {\r\n    statusElement.textContent = message;\r\n  }\r\n}\r\n\r\n// エラーを表示する関数\r\nfunction showError(message: string): void {\r\n  updateStatus(`エラー: ${message}`);\r\n}\r\n\r\n// 推奨フォルダを表示する関数\r\nfunction displayRecommendedFolders(\r\n  folders: FolderVec[],\r\n  currentTab: Tab\r\n): void {\r\n  const folderListElement: HTMLElement | null =\r\n    document.getElementById(\"folderList\");\r\n  if (!folderListElement) return;\r\n\r\n  // フォルダリストをクリア\r\n  folderListElement.innerHTML = \"\";\r\n\r\n  // ステータスを更新\r\n  updateStatus(\"推奨フォルダ:\");\r\n\r\n  // 各フォルダのアイテムを作成\r\n  folders.forEach((folder: FolderVec) => {\r\n    const folderItem: HTMLDivElement = document.createElement(\"div\");\r\n    folderItem.className = \"folder-item\";\r\n    folderItem.dataset.folderId = folder.folderId;\r\n\r\n    // フォルダ名と類似度スコアを表示\r\n    // const similarityPercentage: number = Math.round(folder.score * 100);\r\n    // folderItem.innerHTML = `\r\n    //   <span class=\"folder-name\">${folder.name}</span>\r\n    //   <span class=\"similarity-score\">${similarityPercentage}%</span>\r\n    // `;\r\n    folderItem.innerHTML = `\r\n      <span class=\"folder-name\">${folder.name}</span>\r\n    `;\r\n    // クリックイベントを追加\r\n    folderItem.addEventListener(\"click\", async (): Promise<void> => {\r\n      try {\r\n        // ブックマークを作成\r\n        await chrome.bookmarks.create({\r\n          parentId: folder.folderId,\r\n          title: currentTab.title,\r\n          url: currentTab.url,\r\n        });\r\n\r\n        // 成功メッセージを表示\r\n        updateStatus(`「${folder.name}」にブックマークしました`);\r\n\r\n        // フォルダリストをクリア\r\n        folderListElement.innerHTML = \"\";\r\n\r\n        // 3秒後にポップアップを閉じる\r\n        setTimeout((): void => {\r\n          window.close();\r\n        }, 3000);\r\n      } catch (error) {\r\n        console.error(\"ブックマーク作成中にエラーが発生しました:\", error);\r\n        showError(\"ブックマークの作成中にエラーが発生しました\");\r\n      }\r\n    });\r\n\r\n    // フォルダリストに追加\r\n    folderListElement.appendChild(folderItem);\r\n  });\r\n}\r\n"],"names":["setupButtonEventListeners","rebuildButton","suggestButton","handleRebuildFolders","handleSuggestFolders","updateStatus","response","showError","error","tabs","currentTab","displayRecommendedFolders","message","statusElement","folders","folderListElement","folder","folderItem"],"mappings":"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"}